<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="board">
	<typeAlias alias="BoardModel" type="board.model.BoardModel"/>
	<typeAlias alias="BoardCommentModel" type="board.model.BoardCommentModel"/>
	
	<select id="getBoardList" parameterClass="java.util.HashMap" resultClass="BoardModel">
		select b.idx, b.hitcount, b.recommendcount, to_char(b.writedate, 'YYYY-MM-DD HH:MI:SS') writeDate,
			count(c.idx) as "commet", b.writerId, b.fileName, b.rnum
			from (select a.idx, a.writer, a.subject, a.content, a.hitcount, a.recommendcount,
				  a.weitedate, a.writerId, a.fileName, rownum rnum
				  form (select idx, writer, subject, content, hitcount, recommendcount,
				  		weitedate, writerId, fileName from sin_jmboard order by idx desc)
				  a)
		    b left outer join sin_jmboard_comment c on b.idx = c.linkedarticlenum
		    where rnum between #startArticleNum# and #endArticleNum#
		    group by b.idx, b.writer, b.subject, b.content, b.hitcount, b.recommendcount,
			b.weitedate, b.writerId, b.fileName order by b.idx desc 
	</select> 
	
	<select id="getSearchTotalNum" resultClass="int">
		select count(idx)
		from sin_jmboard
		where $type$ like '$keyword$'
	</select>
	
	<select id="searchArticle" parameterClass="java.util.HashMap" resultClass="BoardModel">
		select 
			b.idx, b.writer, b.subject,
			b.content, b.hitcount, b.recommendcount,
			to_char(b.writedate, 'YYYY-MM-DD HH:MI:SS') writeDate, 
			count(c.idx) as "comment", 
			b.writerId, b.fileName, b.rnum
		from (select 
				a.idx, a.writer, a.subject,
				a.content, a.hitcount, a.recommendcount,
				a.writedate, a.writerId, a.fileName, rownum rnum
			from (select 
					idx, writer, subject,
					content, hitcount, recommendcount,
					writedate, writerId, fileName
				from sin_jmboard
				where $type$ like '%$keyword$%'
        		order by idx desc) a
        ) b left outer join sin_jmboard_comment c on b.idx = c.linkedarticlenum
	    where rnum between #startArticleNum# and #endArticleNum#
	    group by 
	    	b.idx, b.writer, b.subject, 
	    	b.content, b.hitcount, b.recommendcount, 
	    	b.writedate, b.rnum, b.writerId, b.fileName
	    order by b.idx desc		
	</select>
	
	<select id="getOneArticle" parameterClass="int" resultClass="BoardModel">
		select
			idx,
			writer,
			subject,
			content,
			hitcount,
			recommendcount,
			writedate,
			writerId,
			fileName
		from sin_jmboard
    	where idx = #idx#
	</select>
	
	<select id="getCommentList" parameterClass="int" resultClass="BoardCommentModel">
		select 
			idx, writer, content, 
			writeDate, linkedArticleNum, writerId
		from sin_jmboard_comment
  		where linkedArticleNum = #idx#
  		order by idx desc
	</select>
	
	<select id="getOneComment" parameterClass="int" resultClass="BoardCommentModel">
		select 
			idx, writer,
			content, 
			writeDate, linkedArticleNum, writerId
		from sin_jmboard_comment
  		where idx = #idx#		
	</select>
	
	<insert id="writeArticle" parameterClass="BoardModel">
		insert into sin_jmboard(idx, writer, subject, content, hitcount, recommendcount, writeDate, writerId, fileName)
			values(BOARDLISTSEQ.nextVal, #writer#, #subject#, #content#, 0, 0, sysdate, #writerId#, #fileName#)
	</insert>
	
	<insert id="writeComment" parameterClass="BoardCommentModel">
		insert into sin_jmboard_comment(idx, writer, content, writeDate, linkedArticleNum, writerId)
			values(BOARDCOMMENTSEQ.nextVal, #writer#, #content#, sysdate, #linkedArticleNum#, #writerId#)
	</insert>
	
	<update id="updateHitcount" parameterClass="java.util.HashMap">
		update 
			sin_jmboard 
		set hitcount = #hitcount#
		where idx = #idx#
	</update>
	
	<update id="updateRecommendcount" parameterClass="java.util.HashMap">
		update
			sin_jmboard
		set recommendcount = #recommendcount#
		where idx = #idx#
	</update>
	
	<delete id="deleteComment" parameterClass="int">
		delete
		from sin_jmboard_comment
		where idx = #idx#
	</delete>
	
	<delete id="deleteArticle" parameterClass="int">
		delete
		from sin_jmboard
		where idx = #idx#	
	</delete>
	
	<update id="modifyArticle" parameterClass="BoardModel">
		update sin_jmboard
		set subject = #subject#,
			content = #content#,
			fileName = #fileName#
		where idx = #idx#
	</update>
	
</sqlMap>